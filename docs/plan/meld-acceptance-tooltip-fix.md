# ポン後の受け入れツールチップ表示修正 & 和了形対応

## 作業計画

1. **問題の特定**
   - 現在の受け入れ計算の条件を確認
   - ポン後（11枚以下の手牌）でツールチップが表示されない原因を調査
   - ツモ牌がない状態での受け入れ計算の対応状況を確認

2. **修正方針の策定**
   - 鳴き牌がある場合でも受け入れ計算を実行するよう修正
   - 手牌枚数に応じた適切な受け入れ計算処理の実装
   - ツモ牌の有無に関わらず受け入れ情報を表示する機能の追加
   - 和了形でもツールチップを表示する機能の追加

3. **実装修正**
   - `updateAcceptanceInfo`関数の条件を修正
   - 鳴き牌を考慮した受け入れ計算の実装
   - ツールチップ表示条件の調整
   - 和了形用の計算関数の実装

4. **動作確認**
   - ポン後の受け入れツールチップ表示のテスト
   - 各種鳴き牌パターンでの動作確認
   - 和了形でのツールチップ表示確認

## 設計思想

### 1. 包括的な受け入れ計算
- ツモ牌の有無に関わらず受け入れ計算を実行
- 鳴き牌がある場合の手牌枚数（10枚、7枚、4枚等）に対応
- メルド（鳴き牌）を考慮したシャンテン数と受け入れ牌の計算
- 和了形でも各牌を切った後の状態を表示

### 2. 適切な表示条件
- 人間プレイヤーのターンであれば受け入れ情報を表示
- 手牌が存在する限り受け入れ計算を実行
- 設定で受け入れ表示が有効な場合のみ処理を実行
- 和了形、テンパイ、シャンテンの状態を分かりやすく表示

### 3. パフォーマンス最適化
- 既存のキャッシュ機能を活用
- Rustライブラリによる高速化の恩恵を最大化
- 不要な計算の回避とキャンセル機能の維持

## 作業対象ファイル

### ファイル名: src/views/FourPlayerGameView/script.ts
### 改修内容:
- 鳴き牌がある場合の手牌枚数チェックを修正（1444-1457行）
- 和了形でも受け入れ計算を実行するよう修正（1492-1509行）
- `calculateSingleTileAcceptance`関数を鳴き牌対応に修正（2197-2269行）
- `calculateUsefulTilesForMeldsWithCancel`関数で有効牌計算を修正（2041-2059行）
- `calculateWinningHandInfo`と`calculateWinningHandInfoForMelds`関数を追加（2096-2186行）

### ファイル名: src/components/AcceptancePopup.vue
### 改修内容:
- 和了形、テンパイ、シャンテンの表示を改善（32-41行）
- 受け入れ牌がない場合の表示を追加（45-47行）
- `getShantenText`関数を追加（101-109行）
- スタイルの追加（219-224行）